<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETHMumbai Maxi Checker</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Restoring the Original Dark UI Palette */
            --c-white: #e0e0e0;
            --c-black: #121212;
            --c-green: #00e676; 
            --c-pink: #ff4081;
            --c-yellow: #ffea00;
            --c-red: #d50000;
            --c-bg: #212121;
            --c-road: #2c2c2c;
        }

        * {
            box-sizing: border-box;
            touch-action: none;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--c-black);
            font-family: 'VT323', monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: var(--c-white);
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 480px;
            height: 100%;
            background-color: #333;
            overflow: hidden;
            border: 2px solid #444;
            box-shadow: 0 0 15px rgba(0,0,0,0.8);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: #1a1a1a; /* Matte Night Sky */
        }

        /* UI Overlay Styles */
        .ui-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(18, 18, 18, 0.96);
            z-index: 10;
            text-align: center;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        h1 {
            font-size: 3.5rem;
            color: var(--c-yellow);
            text-shadow: 3px 3px #000;
            margin-bottom: 5px;
            line-height: 0.9;
        }

        p {
            font-size: 1.5rem;
            color: #aaa;
            margin-bottom: 30px;
        }

        input {
            background: #000;
            border: 2px solid var(--c-green);
            color: var(--c-white);
            padding: 10px;
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 20px;
            width: 80%;
            text-transform: uppercase;
            outline: none;
        }

        .btn-primary {
            background: var(--c-green);
            color: #000;
            border: 2px solid var(--c-white);
            padding: 15px 30px;
            font-family: 'VT323', monospace;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 0 #000;
            transition: transform 0.1s;
        }

        .btn-primary:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #000;
        }

        /* Radio Toggle */
        #radio-container {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 5;
        }

        .radio-btn {
            background: rgba(0,0,0,0.5);
            color: var(--c-white);
            border: 1px solid var(--c-yellow);
            padding: 5px 10px;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.8;
        }
        
        .radio-active {
            background: var(--c-yellow);
            color: var(--c-black);
            opacity: 1;
        }

        /* Receipt Style */
        #receipt-card {
            background: #fff;
            color: #000;
            width: 90%;
            padding: 20px;
            border-top: 8px dashed #333;
            border-bottom: 8px dashed #333;
            font-family: 'VT323', monospace;
            transform: rotate(-1deg);
            box-shadow: 5px 5px 10px rgba(0,0,0,0.7);
            text-align: left;
            margin-bottom: 20px;
        }

        .receipt-header {
            text-align: center;
            border-bottom: 2px dashed #000;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            font-size: 1.3rem;
            margin: 5px 0;
        }

        .receipt-comment {
            font-size: 1.2rem;
            color: #333;
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: #f4f4f4;
            border: 1px solid #ccc;
            line-height: 1.2;
        }

        .stamp {
            font-size: 2.2rem;
            color: var(--c-red);
            border: 4px solid var(--c-red);
            padding: 5px;
            text-align: center;
            margin-top: 15px;
            transform: rotate(-5deg);
            font-weight: bold;
            opacity: 0.8;
        }

        /* HUD */
        .controls-hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.3);
            font-size: 1.2rem;
            pointer-events: none;
        }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="radio-container">
            <button id="music-btn" class="radio-btn" onclick="toggleRadio()">ðŸ“» FM: OFF</button>
        </div>

        <div id="start-screen" class="ui-screen">
            <h1>ETHMUMBAI<br>VIBE CHECK</h1>
            <p>ETHMumbai Maxi Edition</p>
            <input type="text" id="username" placeholder="ENTER YOUR X HANDLE" maxlength="32">
            <button class="btn-primary" onclick="startGame()">START RIDE</button>
            <div style="margin-top: 20px; font-size: 1rem; color: #777;">Swipe or Arrows to Switch Lanes</div>
        </div>

        <div id="end-screen" class="ui-screen hidden">
            <div id="receipt-card">
                <div class="receipt-header">
                    <h2>VIBE CHALAN</h2>
                    <span style="font-size: 0.9rem">MH-12-ETH-2026</span>
                </div>
                <div class="receipt-row">
                    <span>DRIVER:</span>
                    <span id="r-name">@USER</span>
                </div>
                <div class="receipt-row">
                    <span>SCORE:</span>
                    <span id="r-score">0 pts</span>
                </div>
                <div class="receipt-row">
                    <span>VIBE TYPE:</span>
                    <span id="r-type">...</span>
                </div>
                <hr style="border: 1px dashed black;">
                <div class="receipt-comment" id="r-slang">
                    "Calculating..."
                </div>
                <div class="stamp" id="r-persona">
                    PENDING...
                </div>
            </div>
            <button class="btn-primary" onclick="resetGame()">RIDE AGAIN</button>
            <button style="background: var(--c-black); color: var(--c-white); border: 2px solid white; margin-top: 10px; padding: 10px; font-family: 'VT323'; font-size: 1.5rem; cursor: pointer; width:auto;" onclick="shareResult()">SHARE FLEX ON X</button>
        </div>

        <div class="controls-hint" id="hud-hint">Swipe Left / Right</div>
    </div>

    <script>
        // --- GAME CONFIG ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const LANES = 3;
        
        // Game State
        let isPlaying = false;
        let frameCount = 0;
        let speed = 6;
        let score = 0; 
        
        // Vibe Trackers
        let ethScore = 0;    // Points for "Maxi/Builder" choices
        let degenScore = 0;  // Points for "Degen/Risk" choices
        let normieScore = 0; // Points for "Web2/Normie" choices
        
        let username = "GUEST";
        let laneIndex = 1; 

        // Colors
        const COLORS = {
            road: '#2c2c2c',
            grass: '#1a1a1a',
            lane: '#666',
            taxiBody: '#111',   // Black
            taxiTop: '#ffea00', // Yellow Roof
            gateEth: '#00e676',   // Green
            gateDegen: '#ff4081', // Pink
            gateNormie: '#90a4ae',// Greyish Blue
            
            bugSpike: '#ff5252',
            bugPothole: '#121212',
            bugBarricade: '#ffeb3b',
        };

        let obstacles = [];
        let playerY = 0;

        // --- AUDIO ---
        let audioCtx = null;
        let musicInterval = null;
        let isRadioOn = false;

        function initAudio() {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playNote(freq, type, duration, vol=0.05) {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function toggleRadio() {
            initAudio();
            const btn = document.getElementById('music-btn');
            isRadioOn = !isRadioOn;
            if (isRadioOn) {
                if(audioCtx.state === 'suspended') audioCtx.resume();
                btn.innerText = "ðŸ“» FM: ON ðŸŽµ";
                btn.classList.add('radio-active');
                startLoFiLoop();
            } else {
                btn.innerText = "ðŸ“» FM: OFF";
                btn.classList.remove('radio-active');
                stopLoFiLoop();
            }
        }

        function startLoFiLoop() {
    if (musicInterval) clearInterval(musicInterval);

    const bass = [82, 82, 98, 82]; // warm low notes
    const melody = [196, 220, 246, 220]; // soft synth

    let i = 0;

    musicInterval = setInterval(() => {
        // Tabla-style bass hit
        playNote(bass[i % bass.length], 'sine', 0.4, 0.06);

        // Soft lo-fi melody
        setTimeout(() => {
            playNote(melody[i % melody.length], 'triangle', 0.5, 0.025);
        }, 120);

        // Vinyl hiss (very subtle)
        playNote(3000 + Math.random() * 2000, 'square', 0.02, 0.005);

        i++;
    }, 420); // relaxed tempo
}


        function stopLoFiLoop() {
            if(musicInterval) clearInterval(musicInterval);
        }

        // --- RESIZE ---
        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            playerY = canvas.height - 160;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- INPUT ---
        let touchStartX = 0;
        document.addEventListener('keydown', (e) => {
            if (!isPlaying) return;
            if (e.key === 'ArrowLeft') moveLeft();
            if (e.key === 'ArrowRight') moveRight();
        });
        canvas.addEventListener('touchstart', (e) => touchStartX = e.changedTouches[0].screenX);
        canvas.addEventListener('touchend', (e) => {
            if (!isPlaying) return;
            const touchEndX = e.changedTouches[0].screenX;
            if (touchEndX < touchStartX - 30) moveLeft();
            if (touchEndX > touchStartX + 30) moveRight();
        });

        function moveLeft() { if (laneIndex > 0) laneIndex--; }
        function moveRight() { if (laneIndex < LANES - 1) laneIndex++; }

        // --- DRAWING ---
        function drawRoad() {
            ctx.fillStyle = COLORS.grass;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            let margin = 10;
            ctx.fillStyle = COLORS.road;
            ctx.fillRect(margin, 0, canvas.width - (margin*2), canvas.height);
            ctx.strokeStyle = COLORS.lane;
            ctx.setLineDash([40, 40]);
            ctx.lineWidth = 4;
            ctx.beginPath();
            let roadW = canvas.width - (margin*2);
            let singleLane = roadW / 3;
            let offset = (frameCount * speed) % 80;
            for(let i=1; i<3; i++) {
                ctx.moveTo(margin + singleLane * i, -80 + offset);
                ctx.lineTo(margin + singleLane * i, canvas.height);
            }
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawPlayer() {
            let roadW = canvas.width - 20;
            let singleLane = roadW / 3;
            let x = 10 + (laneIndex * singleLane) + (singleLane / 2) - 30;
            
            // --- DRAW REALISTIC TAXI (Kaali Peeli) ---
            
            // Tires (Black rectangles sticking out)
            ctx.fillStyle = '#000';
            ctx.fillRect(x - 4, playerY + 15, 8, 15); // FL
            ctx.fillRect(x + 56, playerY + 15, 8, 15); // FR
            ctx.fillRect(x - 4, playerY + 60, 8, 15); // RL
            ctx.fillRect(x + 56, playerY + 60, 8, 15); // RR

            // Main Chassis (Black Body)
            ctx.fillStyle = COLORS.taxiBody;
            ctx.beginPath();
            ctx.roundRect(x, playerY, 60, 85, 8);
            ctx.fill();

            // Roof (Yellow)
            ctx.fillStyle = COLORS.taxiTop;
            ctx.beginPath();
            ctx.roundRect(x + 5, playerY + 15, 50, 45, 5);
            ctx.fill();

            // Windshield (Blue-ish glass)
            ctx.fillStyle = '#81d4fa';
            ctx.fillRect(x + 8, playerY + 18, 44, 12);
            
            // Rear Window
            ctx.fillStyle = '#444';
            ctx.fillRect(x + 8, playerY + 45, 44, 10);

            // Taxi Sign (On Roof)
            ctx.fillStyle = '#000';
            ctx.fillRect(x + 20, playerY + 30, 20, 8);
            ctx.fillStyle = '#ff0';
            ctx.font = '8px Arial';
            ctx.fillText("TAXI", x + 22, playerY + 37);

            // Headlights (Beams)
            ctx.fillStyle = 'rgba(255, 255, 200, 0.6)';
            ctx.beginPath();
            ctx.moveTo(x + 5, playerY);
            ctx.lineTo(x - 10, playerY - 40);
            ctx.lineTo(x + 20, playerY - 40);
            ctx.lineTo(x + 15, playerY);
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(x + 45, playerY);
            ctx.lineTo(x + 40, playerY - 40);
            ctx.lineTo(x + 70, playerY - 40);
            ctx.lineTo(x + 55, playerY);
            ctx.fill();

            // Headlights (Bulbs)
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(x + 10, playerY + 2, 4, 0, Math.PI*2);
            ctx.arc(x + 50, playerY + 2, 4, 0, Math.PI*2);
            ctx.fill();
        }

        function drawObstacles() {
            let roadW = canvas.width - 20;
            let singleLane = roadW / 3;

            obstacles.forEach(obs => {
                let x = 10 + (obs.lane * singleLane);
                let w = singleLane;
                let centerX = x + w/2;
                
                if (obs.category === 'bug') {
                    // --- DRAW BUG (High Visibility) ---
                    let label = "BUG";
                    let color = '#fff';
                    
                    if(obs.type === 'spike') {
                        ctx.fillStyle = COLORS.bugSpike;
                        ctx.beginPath();
                        ctx.moveTo(centerX - 20, obs.y + 40); 
                        ctx.lineTo(centerX, obs.y); 
                        ctx.lineTo(centerX + 20, obs.y + 40);
                        ctx.fill();
                        label = "RPC FAILURE";
                    } else if (obs.type === 'pothole') {
                        ctx.fillStyle = COLORS.bugPothole;
                        ctx.beginPath(); ctx.ellipse(centerX, obs.y + 20, 30, 15, 0, 0, Math.PI * 2); ctx.fill();
                        ctx.strokeStyle = '#555'; ctx.lineWidth = 2; ctx.stroke();
                        label = "KYC WALL";
                    }

                    // Floating Label Box for Readability
                    ctx.fillStyle = '#000';
                    ctx.fillRect(centerX - 40, obs.y + 45, 80, 20);
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(centerX - 40, obs.y + 45, 80, 20);
                    
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 16px VT323';
                    ctx.textAlign = 'center';
                    ctx.fillText(label, centerX, obs.y + 60);

                } else if (obs.category === 'gate') {
                    // --- DRAW 3D GATE ---
                    let color = COLORS.gateNormie;
                    if(obs.subtype === 'eth') color = COLORS.gateEth;
                    if(obs.subtype === 'degen') color = COLORS.gateDegen;

                    // 1. Pillars (Side shading)
                    ctx.fillStyle = '#222'; // Dark side
                    ctx.fillRect(x + 2, obs.y, 8, 90); // Left Pillar
                    ctx.fillRect(x + w - 10, obs.y, 8, 90); // Right Pillar
                    
                    ctx.fillStyle = '#555'; // Front face
                    ctx.fillRect(x + 6, obs.y, 4, 90);
                    ctx.fillRect(x + w - 6, obs.y, 4, 90);

                    // 2. Top Banner (Background)
                    ctx.fillStyle = '#111';
                    ctx.fillRect(x + 2, obs.y, w - 4, 40);
                    
                    // 3. Neon Border
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.shadowColor = color;
                    ctx.shadowBlur = 10;
                    ctx.strokeRect(x + 6, obs.y + 4, w - 12, 32);
                    ctx.shadowBlur = 0; // Reset blur

                    // 4. Text (High Contrast)
                    ctx.fillStyle = color;
                    ctx.font = 'bold 26px VT323';
                    ctx.textAlign = 'center';
                    
                    // Text Outline for visibility
                    ctx.lineWidth = 3;
                    ctx.strokeStyle = '#000';
                    ctx.strokeText(obs.text, centerX, obs.y + 28);
                    
                    ctx.fillText(obs.text, centerX, obs.y + 28);
                }
            });
        }

        // --- GAME LOGIC ---

        const vibeOptions = [
            [{t:"VITALIK", s:"eth"}, {t:"ELON MUSK", s:"normie"}],
            [{t:"ETHEREUM", s:"eth"}, {t:"SOLANA", s:"degen"}],
            [{t:"DEFI", s:"eth"}, {t:"CEFI", s:"normie"}],
            [{t:"VADA PAV", s:"eth"}, {t:"BURGER", s:"normie"}],
            [{t:"HODL", s:"eth"}, {t:"PANIC SELL", s:"normie"}],
            [{t:"ZK ROLLUP", s:"eth"}, {t:"MEMECOIN", s:"degen"}],
            [{t:"BUILDER", s:"eth"}, {t:"INFLUENCER", s:"degen"}],
            [{t:"CHAI", s:"eth"}, {t:"STARBUCKS", s:"normie"}],
            [{t:"SMART CONTRACT", s:"eth"}, {t:"PDF DOC", s:"normie"}],
            [{t:"TESTNET", s:"eth"}, {t:"MAINNET APE", s:"degen"}],
            [{t:"GRANT", s:"eth"}, {t:"VC MONEY", s:"normie"}],
            [{t:"OPEN SRC", s:"eth"}, {t:"CLOSED BETA", s:"normie"}],
            [{t:"WAGMI", s:"eth"}, {t:"NGMI", s:"normie"}],
            [{t:"L2", s:"eth"}, {t:"L1 KILLER", s:"degen"}],
            [{t:"ENS", s:"eth"}, {t:"GMAIL", s:"normie"}],
            [{t:"THE LALIT", s:"eth"}, {t:"TAJ HOTEL", s:"normie"}],
            [{t:"HACKATHON", s:"eth"}, {t:"CLUBBING", s:"degen"}],
            [{t:"DAO", s:"eth"}, {t:"BOARD ROOM", s:"normie"}],
            [{t:"AAVE", s:"eth"}, {t:"BANK LOAN", s:"normie"}],
            [{t:"METAMASK", s:"eth"}, {t:"ROBINHOOD", s:"normie"}]
        ];

        function spawnObstacle() {
            if (frameCount % 60 === 0) {
                let lane = Math.floor(Math.random() * LANES);
                let isGate = Math.random() > 0.5;

                if (isGate && frameCount % 120 === 0) {
                    spawnGateRow();
                } else if (!isGate) {
                    let bugType = Math.random() > 0.5 ? 'spike' : 'pothole';
                    obstacles.push({
                        lane: lane,
                        y: -100,
                        category: 'bug',
                        type: bugType,
                        active: true
                    });
                }
            }
        }

        function spawnGateRow() {
            let pair = vibeOptions[Math.floor(Math.random() * vibeOptions.length)];
            let swap = Math.random() > 0.5;
            let leftOpt = swap ? pair[1] : pair[0];
            let rightOpt = swap ? pair[0] : pair[1];

            obstacles.push({
                lane: 0,
                y: -100,
                category: 'gate',
                subtype: leftOpt.s,
                text: leftOpt.t,
                active: true
            });

            obstacles.push({
                lane: 2,
                y: -100,
                category: 'gate',
                subtype: rightOpt.s,
                text: rightOpt.t,
                active: true
            });
        }

        function update() {
            obstacles.forEach(obs => obs.y += speed);
            obstacles = obstacles.filter(obs => obs.y < canvas.height + 50);

            obstacles.forEach(obs => {
                if (!obs.active) return;
                
                if (obs.y > playerY && obs.y < playerY + 80) { // Adjusted hitbox for new car
                    if (laneIndex === obs.lane) {
                        if (obs.category === 'bug') {
                            gameOver();
                        } else if (obs.category === 'gate') {
                            if (obs.subtype === 'eth') ethScore++;
                            if (obs.subtype === 'degen') degenScore++;
                            if (obs.subtype === 'normie') normieScore++;
                            score += 10;
                            obs.active = false;
                        }
                    }
                }
            });

            score++;
            if (score % 600 === 0) speed += 0.5;
        }

        function loop() {
            if (!isPlaying) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            frameCount++;
            drawRoad();
            spawnObstacle();
            update();
            drawObstacles();
            drawPlayer();
            
            // HUD
            ctx.fillStyle = '#fff';
            ctx.font = '22px VT323';
            ctx.textAlign = 'left';
            ctx.fillText(`DIST: ${Math.floor(score/10)}m`, 20, 30);

            requestAnimationFrame(loop);
        }

        // --- STATE MANAGEMENT ---

        function startGame() {
            const input = document.getElementById('username');
            if (input.value.trim() === "") {
                alert("ENTER YOUR WEB3 HANDLE!");
                return;
            }
            username = input.value;
            initAudio();
            
            score = 0; 
            ethScore = 0; degenScore = 0; normieScore = 0;
            speed = 6;
            obstacles = [];
            laneIndex = 1;
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('hud-hint').style.display = 'block';
            
            if(isRadioOn) startLoFiLoop();
            isPlaying = true;
            loop();
        }

        function gameOver() {
            isPlaying = false;
            stopLoFiLoop();
            playNote(100, 'sawtooth', 0.3);
            generateReceipt();
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('hud-hint').style.display = 'none';
        }

        function resetGame() {
            document.getElementById('end-screen').classList.add('hidden');
            startGame();
        }

function generateReceipt() {
            document.getElementById('r-name').innerText = "@" + username;
            document.getElementById('r-score').innerText = Math.floor(score) + " pts";

            // --- MUMBAI SLANG + WEB3 COMMENTS ---
            let persona = "ROOKIE DRIVER";
            let type = "FIRST RIDE";
            let slang = "Bas shuru kiya, abhi toh bohot kuch seekhna hai!";
            let stampColor = COLORS.gateNormie;

            // Arrays of random slang for variation
            const paperHandsSlang = [
                "Bhai, Saki Naka traffic se bhi slow nikle tum.",
                "Meter down hote hi crash? Rickshaw hai ya Luna?",
                "Beta, tumse na ho payega. Go back to Web2.",
                "Portfolio rekt, mood upset. Kya gunda banega re tu?"
            ];
            
            const normieSlang = [
                "Bhai, Starbucks chod, Cutting Chai peene aaja.",
                "You are too simple for this crypto raada.",
                "Normie vibes only. Lagta hai first time aaya hai Mumbai.",
                "Dadar station ki bheed dekh ke darr gaya kya?"
            ];

            const degenSlang = [
                "Visay hard hai bhai! Full leverage trading chalu hai?",
                "Ekdum kadak! Risk hai toh ishq hai.",
                "Full scene sort hai. Seedha moon pe jayega apun.",
                "Bhai tu toh heavy driver nikla! No fear, only gear."
            ];

            const maxiSlang = [
                "Ek Number! Tu asli builder hai boss.",
                "Solid choices. Tu hi sambhalega ETHMumbai ka scene.",
                "Load mat le, WAGMI confirm hai tera.",
                "Vada Pav aur Whitepaper, deadly combination boss."
            ];

            // Determine Vibe
            // ---- NORMALIZED METRICS ----
            const totalChoices = ethScore + degenScore + normieScore;
            const ethRatio = totalChoices > 0 ? ethScore / totalChoices : 0;
            const degenRatio = totalChoices > 0 ? degenScore / totalChoices : 0;
            const normieRatio = totalChoices > 0 ? normieScore / totalChoices : 0;

            // ---- PERSONA DECISION (Fixed logic to always assign a value) ----
            if (score < 350 && totalChoices < 3) {
                persona = "PAPER HANDS";
                type = "FIRST TIMER";
                slang = paperHandsSlang[Math.floor(Math.random() * paperHandsSlang.length)];
                stampColor = COLORS.bugSpike;
            }
            else if (ethRatio > 0.7 && score > 4500) {
                // LEGEND check moved earlier to prevent PENDING
                persona = "LEGEND";
                type = "ETHMUMBAI OG";
                slang = "Bear market, potholes aur gas wars â€” sab survive kiya boss.";
                stampColor = COLORS.taxiTop;
            }
            else if (ethRatio > 0.65 && normieRatio < 0.15 && score > 2200) {
                persona = "INFRA MAXI";
                type = "PROTOCOL NERD";
                slang = "Docs padhe, nodes chalaye, gas bachaya. ETHMumbai ka asli scene.";
                stampColor = COLORS.gateEth;
            }
            else if (ethRatio > 0.5 && score > 1200) {
                persona = "ETH MAXI";
                type = "TRUE BUILDER";
                slang = maxiSlang[Math.floor(Math.random() * maxiSlang.length)];
                stampColor = COLORS.gateEth;
            }
            else if (degenRatio > 0.4 && score > 800) {
                persona = "DEGEN APE";
                type = "HIGH RISK DRIVER";
                slang = degenSlang[Math.floor(Math.random() * degenSlang.length)];
                stampColor = COLORS.gateDegen;
            }
            else if (normieRatio > 0.4) {
                persona = "NORMIE";
                type = "WEB2 TOURIST";
                slang = normieSlang[Math.floor(Math.random() * normieSlang.length)];
                stampColor = COLORS.gateNormie;
            }
            else if (totalChoices > 0) {
                // Fallback for any other combination
                if (ethScore >= degenScore && ethScore >= normieScore) {
                    persona = "BUILDER";
                    type = "RISING STAR";
                    slang = "Sahi direction mein ja raha hai. Keep building!";
                    stampColor = COLORS.gateEth;
                } else if (degenScore > normieScore) {
                    persona = "RISK TAKER";
                    type = "BOLD DRIVER";
                    slang = "Thoda risky, thoda fun. That's the spirit!";
                    stampColor = COLORS.gateDegen;
                } else {
                    persona = "EXPLORER";
                    type = "LEARNING MODE";
                    slang = "Chal raha hai scene. Thoda aur gas de!";
                    stampColor = COLORS.gateNormie;
                }
            }

            document.getElementById('r-persona').innerText = persona;
            document.getElementById('r-persona').style.color = stampColor;
            document.getElementById('r-persona').style.borderColor = stampColor;
            
            document.getElementById('r-type').innerText = type;
            document.getElementById('r-slang').innerText = `"${slang}"`;
        }

        function shareResult() {
            let persona = document.getElementById('r-persona').innerText;
            let slang = document.getElementById('r-slang').innerText;
            let text = `Just took the ETHMumbai Vibe Check: ðŸš•%0A%0ARole: ${persona}%0AVibe: ${slang}%0AScore: ${Math.floor(score)}%0A%0ACheck your vibe here:https://eth-mumbai-mix.netlify.app/`;
            window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
        }

    </script>
</body>
</html>
